from datos.conexion import Session
from sqlalchemy import func
from modelos.autor import Autor
from modelos.libro import Libro 

sesion = Session() 


def crear_objeto(objeto):
    sesion.add(objeto)
    try:
        sesion.commit()
        print("El objeto se ha guardado correctamente.")
    except Exception as e:
        sesion.rollback()
        print(f"Error al guardar el objeto: {e}")
    finally:
        sesion.close()

def modificar_objeto(objeto):
    sesion.merge(objeto)
    try:
        sesion.commit()
        print("El objeto se ha modificado correctamente.")
    except Exception as e:
        sesion.rollback()
        print(f"Error al modificar el objeto: {e}")
    finally:
        sesion.close()

def guardar_autor(nombre, apellido, nacionalidad):
    if nombre != '' and apellido != '':
        nuevo_autor = Autor(
            nombre_autor=nombre,
            apellido_autor=apellido,
            nacionalidad=nacionalidad.title()
        )
        sesion.add(nuevo_autor)
        try:
            sesion.commit()
            print(
                f"El Autor '{nuevo_autor.nombre_autor} {nuevo_autor.apellido_autor}' se ha registrado correctamente.")
        except Exception as e:
            sesion.rollback()
            print(f"Error al registrar el Autor: {e}")
        finally:
            sesion.close()
    else:
        print('Debe ingresar el nombre y el apellido del autor.')

def guardar_libro(titulo, isbn, año_publicacion, genero, autor_id, copias_disponibles):
    if titulo != '' and isbn != '':
        nuevo_libro = Libro(
            titulo=titulo,
            isbn=isbn,
            anio_publicacion=año_publicacion,
            genero=genero,
            autor_id=autor_id, 
            copias_disponibles=copias_disponibles
        )
        sesion.add(nuevo_libro)
        try:
            sesion.commit()
            print(
                f"El Libro '{nuevo_libro.titulo}' (ISBN: {nuevo_libro.isbn}) se ha guardado correctamente.")
        except Exception as e:
            sesion.rollback()
            print(f"Error al guardar el Libro: {e}")
        finally:
            sesion.close()
    else:
        print('Debe ingresar el título y el ISBN del libro.')